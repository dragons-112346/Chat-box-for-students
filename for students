<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fun Learning Chat</title>

<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: linear-gradient(135deg, #cfd9ff, #f6f7ff);
  margin: 0;
}

#app {
  max-width: 800px;
  margin: 30px auto;
  background: white;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  min-height: 90vh;
  display: flex;
  flex-direction: column;
}

h2 { text-align: center; margin-top: 0; }

#stats {
  text-align: center;
  font-size: 18px;
  margin-bottom: 10px;
}

#chat {
  flex: 1;
  overflow-y: auto;
  padding: 15px;
  background: #f4f6ff;
  border-radius: 12px;
  margin-bottom: 12px;
}

.bot, .user {
  max-width: 75%;
  padding: 10px 14px;
  border-radius: 14px;
  margin: 8px 0;
  font-size: 15px;
}

.bot {
  background: #e0e6ff;
  color: #1a2d8f;
  align-self: flex-start;
  border-bottom-left-radius: 4px;
}

.user {
  background: #4f6cff;
  color: white;
  align-self: flex-end;
  margin-left: auto;
  border-bottom-right-radius: 4px;
}

#input-area {
  display: flex;
  gap: 10px;
}

input {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
}

button {
  padding: 12px 18px;
  border-radius: 10px;
  border: none;
  background: #4f6cff;
  color: white;
  cursor: pointer;
}

button:hover { background: #3c55cc; }

/* FLOATING TOUR BUTTON */
#tourButton {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #ffb703;
  color: #000;
  border-radius: 50px;
  padding: 14px 18px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 6px 15px rgba(0,0,0,0.2);
  z-index: 1000;
}
</style>
</head>

<body>

<div id="app">
  <h2>ğŸ® Fun Learning Chat</h2>
  <div id="stats">ğŸª™ Coins: <span id="coins">0</span></div>
  <div id="chat"></div>

  <div id="input-area">
    <input id="input" placeholder="Ask a question, or type JOKE">
    <button onclick="send()">Send</button>
  </div>
</div>

<div id="tourButton" onclick="runTour()">ğŸ‘‹ TOUR</div>

<script>
let coins = 0;
let step = 0;
let inLesson = false;
let practiceQuestion = 0;
let topic = "";

const chat = document.getElementById("chat");

const jokes = [
  "Why did the math book look sad? Too many problems!",
  "Why was six afraid of seven? Because seven eight nine!",
  "Why did the computer go to school? To improve its bytes!",
  "Why did the banana go to school? To become a smart peel!",
  "Why did the ruler feel important? It measured up!",
  "Why did the eraser feel proud? It fixed mistakes!"
];

function addMessage(text, who = "bot") {
  const div = document.createElement("div");
  div.className = who;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function updateCoins(n) {
  coins += n;
  document.getElementById("coins").textContent = coins;
}

function isGreeting(text) {
  return ["hi","hello","hey"].includes(text.toLowerCase());
}

function startLesson(q) {
  topic = q.toLowerCase();
  inLesson = true;
  step = 1;
  addMessage("ğŸ“˜ Letâ€™s learn step by step!");

  if (topic.includes("+") || topic.includes("add")) {
    addMessage("Step 1: What is 2 + 2?");
  } else if (topic.includes("z")) {
    addMessage("Step 1: In 1 = z âˆ’ 1, what should we do first?");
  } else {
    addMessage("Step 1: What do you think this problem is asking?");
  }
}

function checkLessonAnswer(ans) {
  const a = ans.toLowerCase();

  if (step === 1) {
    if ((topic.includes("add") || topic.includes("+")) && ans === "4") {
      step = 2;
      addMessage("âœ… Correct!");
      addMessage("Step 2: Why do we add numbers?");
    } else if (topic.includes("z") && (a.includes("add") || a.includes("move"))) {
      step = 2;
      addMessage("âœ… Correct!");
      addMessage("Step 2: What number should we add?");
    } else {
      addMessage("âŒ Try again â€” youâ€™ve got this!");
    }
  } else if (step === 2) {
    if (a.includes("together") || a.includes("combine") || a.includes("group") || a.includes("pencil")) {
      addMessage("ğŸ‰ Great explanation!");
      inLesson = false;
      startPractice();
    } else {
      addMessage("âŒ Think about combining things.");
    }
  }
}

function startPractice() {
  practiceQuestion = 1;
  addMessage("ğŸ“ Practice time! 5 questions â€” 10 coins each!");
  askPractice();
}

function askPractice() {
  addMessage(`Question ${practiceQuestion}: What is ${practiceQuestion}+${practiceQuestion}?`);
}

function checkPractice(ans) {
  if (Number(ans) === practiceQuestion * 2) {
    addMessage("âœ… Correct! +10 coins!");
    updateCoins(10);
  } else {
    addMessage("âŒ Thatâ€™s okay â€” keep going!");
  }
  practiceQuestion++;
  if (practiceQuestion <= 5) askPractice();
  else addMessage("ğŸ† Practice complete!");
}

function send() {
  const input = document.getElementById("input");
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, "user");
  input.value = "";

  if (text.toUpperCase() === "JOKE") {
    addMessage("ğŸ˜‚ " + jokes[Math.floor(Math.random()*jokes.length)]);
    return;
  }

  if (!inLesson && practiceQuestion === 0) {
    if (isGreeting(text)) {
      addMessage("ğŸ‘‹ Hi! What would you like to learn today?");
      return;
    }
    startLesson(text);
    return;
  }

  if (inLesson) checkLessonAnswer(text);
  else if (practiceQuestion > 0) checkPractice(text);
}

/* TOUR SYSTEM (FIRST 3 TIMES ONLY) */
let tourCount = Number(localStorage.getItem("tourCount") || 0);

function runTour() {
  addMessage("ğŸ‘‹ Welcome! I teach step by step â€” no skipping.");
  addMessage("ğŸ§  I ask questions to check understanding.");
  addMessage("ğŸª™ Practice earns coins!");
  addMessage("ğŸ˜‚ Type JOKE anytime for fun.");
}

if (tourCount < 3) {
  localStorage.setItem("tourCount", tourCount + 1);
} else {
  document.getElementById("tourButton").style.display = "none";
}

addMessage("ğŸ‘‹ Hi! Ask a question to start learning.");
</script>

</body>
</html>
